<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset=UTF-8>
    <title>JS-Platformer</title>
    <style>
      canvas { background-color: aquamarine; }
    </style>
  </head>
  <body>
    <canvas id="myCanvas" width="720" height="360"></canvas>
    <canvas id="testCanvas" width="32" height="40"></canvas>
    <script>
      let imgChar = new Image();
      const canvas = document.getElementById( "myCanvas" );
      const canvasTest = document.getElementById( "testCanvas" );
      const ctx = canvas.getContext( "2d" );
      const ctxt = canvasTest.getContext( "2d" );
      let leftPressed = false;
      let rightPressed = false;
      let spacePressed = false;
      let charH = 0;
      let charV = 300;
      let charSizeH = 32;
      let charSizeV = 40;

      ctx.imageSmoothingEnabled = false;
      ctxt.imageSmoothingEnabled = false;

      function keyUpHandler( e ) {
        if ( e.key == "Right" || e.key == "ArrowRight" ) {
          rightPressed = false;
        } else if ( e.key == "Left" || e.key == "ArrowLeft" ) {
          leftPressed = false;
        } else if( e.key == " " || e.key == "Spacebar" ) {
          spacePressed = false;
        }
      }

      function keyDownHandler( e ) {
        if ( e.key == "Right" || e.key == "ArrowRight" ) {
          rightPressed = true;
        } else if ( e.key == "Left" || e.key == "ArrowLeft" ) {
          leftPressed = true;
        } else if ( e.key == " " || e.key == "Spacebar" ) {
          spacePressed = true;
        }
      }

      imgChar.onload = function() {
        Promise.all([
          createImageBitmap( imgChar, 3, 1, 18, 20 ), //character left edge starts at 3, top edge at 1, and is 16 px wide, 20px tall
          createImageBitmap( imgChar, 704, 119, 15, 20 )
        ]).then( function( sprites ) {

          function drawChar() {
            ctx.drawImage( sprites[0], charH, charV, charSizeH, charSizeV );
          }

          function drawRChar() {
            ctx.drawImage( sprites[1], charH, charV, charSizeH-5, charSizeV );
          }

          function draw() {
            ctx.clearRect( 0, 0, canvas.width, canvas.height );

            ctxt.drawImage( sprites[0], 0, 0 );
            ctxt.drawImage( sprites[1], 0, 20 );

            if ( leftPressed == true ) {
              drawRChar();
            } else {
              drawChar();
            }

            if ( leftPressed == true ) {
              charH -= 10;
              if ( charH < 0 ) {
                charH = 0;
              }
            } else if ( rightPressed == true ) {
              charH += 10;
              if ( charH > ( canvas.width - charSizeH )) {
                charH = ( canvas.width - charSizeH ); // characters max left edge is 6 pixels away from canvas edge
              }
            }


            requestAnimationFrame( draw );
          }
          draw();
        });
      }

      document.addEventListener( "keydown", keyDownHandler, false );
      document.addEventListener( "keyup", keyUpHandler, false );
      imgChar.src = "images/charactersCroppedFlipped.png"; //sprite sheet is 722px wide, 250px tall
    </script>
  </body>
</html>
